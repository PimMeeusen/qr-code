<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maak een foto</title>
</head>
<body style="font-family:sans-serif;padding:20px">
  <h2>Maak een foto</h2>

  <input id="cameraInput" type="file" accept="image/*" capture="environment" />
  <p id="status"></p>

  <script>
    // ‚úÖ Netlify Function endpoint (zelfde domein)
    const UPLOAD_URL = "/.netlify/functions/upload";

    // üîê moet exact gelijk zijn aan Netlify env var
    const UPLOAD_TOKEN = "maak-iets-geheims-zoals-dit-123";

    // Optioneel: QR-id via ?id=locatie1
    const qrId = new URLSearchParams(location.search).get("id") || "qr";

    const input = document.getElementById("cameraInput");
    const statusEl = document.getElementById("status");

    input.addEventListener("change", async () => {
      const file = input.files?.[0];
      if (!file) return;

      statusEl.textContent = "Uploaden‚Ä¶";

      const fd = new FormData();
      fd.append("file", file);
      fd.append("qrId", qrId);

      try {
        const res = await fetch(UPLOAD_URL, {
          method: "POST",
          headers: { "x-upload-token": UPLOAD_TOKEN },
          body: fd
        });

        if (!res.ok) throw new Error(await res.text());
        statusEl.textContent = "‚úÖ Foto ge√ºpload!";
      } catch (e) {
        console.error(e);
        statusEl.textContent = "‚ùå Upload mislukt.";
      }
    });
  </script>
</body>
</html>
